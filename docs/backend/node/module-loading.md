# 模块加载 相关知识

::: tip 模块说明
在 node.js 中模块分为 3 种：内置模块、自定义模块、第三方模块。
:::

## 1. 优先从缓存中加载

::: tip 模块缓存机制

- **这 3 种模块在第一次加载后都会被缓存，从而提高加载效率**。这也意味着多次调用 require() 不会导致模块的代码被执行多次。

:::

## 2. 内置模块和第三方模块优先级

::: tip 模块优先级

- **内置模块优先级较高**。这也意味着内置模块与第三方模块同名时，加载的是内置模块

:::

## 3. 自定义模块的加载机制

::: tip 加载说明

- 加载自定义模块时需要指定路径
- 加载自定义模块时可以省略后缀名
- 例如：假设 demo 是个自定义模块，使用 require('./demo')，则查找顺序如下：
  - 1. 加载 **demo** 文件内容
  - 2. 加载 **demo.js** 文件内容
  - 3. 加载 **demo.json** 文件内容
  - 4. 加载 **demo.node** 文件内容
  - 5. 加载失败，报错

:::

## 4. 第三方模块的加载机制

::: tip 加载说明

- 加载第三方模块时也有查找顺序
- 例如：假设 demo 是个第三方模块，使用 require('demo')，则查找顺序如下：
  - 1. 加载 **当前文件目录中 node_modules 下的 demo** 文件内容
  - 2. 去 **上一层文件目录中 node_modules 下的 demo** 加载文件内容
  - 3. 继续去 **上一层文件目录中 node_modules 下的 demo** 加载文件内容
  - 4. 直到电脑磁盘根目录，加载失败就报错

:::

## 5. 使用目录作为导入标识

::: tip 加载说明

- 以目录为模块导入时，也有查找顺序
- 例如：假设 demo 是个文件目录，使用 require('demo')，则查找顺序如下：
  - 1. 查看 demo 文件夹中 package.json 里的 main 属性，作为导入入口
  - 2. 若 demo 文件夹中不存在 package.json 或 没有 main 属性，则加载 demo/index.js
  - 3. 若都找不到，就会报错：Error: Cannot find module 'xxx'

:::
