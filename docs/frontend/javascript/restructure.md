# JavaScript 重构小技巧

::: tip 起因

本栏目源于一本书，名为《重构》。书中提倡：一个项目的重构，不应该一次性推倒重写，而应该在不破坏功能的情况下一点一点地优化代码。
在这里，我挑出了一些自己常用的、真正有效果的技巧作为成果，一方面验证自己没有白看此书，另一方也表达我此书观念上的认同。

:::

## 1. 减少对属性的引用

::: details 点击查看 代码改进 案例

```js{3,9}
// 1. 优化前
const arr = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
for (let i = 0; i < arr.length; i++) {
  console.log(i)
}

// 2. 优化后
const arr = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
for (let i = 0, l = arr.length; i < l; i++) {
  console.log(i)
}
```

:::

### 1. 这样真的有用吗？

- 答案是肯定的

### 2. 重新认识 for 循环

- for 循环大致分为四部分：

  - 1. 初始化语句
  - 2. 判断条件
  - 3. 计数器更新
  - 4. 循环体

- for 循环的结构如下

```xml
一、语法结构：
  for (初始化语句; 判断条件; 计数器更新) {
    循环体
  }


二、给结构编号：
  1. 初始化语句
  2. 判断条件
  3. 计数器更新
  4. 循环体
```

- for 循环的执行过程

```js
// 我们先给 for 循环的 4 个部分进行了编号，当js执行到 for 循环时：
// 第一步: 进行初始化，也就是执行 '部分1'
// 第二步: 进行判断，也就是执行 '部分2'
// 第三步: 条件成立，执行循环体，也就是 '部分4'
// 第四步: 计数器更新，也就是 '部分3'
// 第五步: 进行判断，也就是执行 '部分2'
// 第六步: 条件成立，执行循环体，也就是 '部分4'
// 重复 324 步骤。。。。。

// 也就是说一个正常的循环，大致顺序为：124 324 324 324 324 324......
// 可以看到，初始化语句只会执行一次
```

### 3. 读取属性（或变量）

我们知道：要使用对象或数组的某个属性 可以用 `.` 的形式来访问，是一个动作，要消耗 ‘能量’，而直接读取一个属性，也是一个动作，同样消耗 ‘能量’。问题就在于谁消耗的 少

```js
let length = 6
console.log(length) // 直接访问：读取了 length ，消耗 1 个单位能量

let arr = []
console.log(arr.length) // 间接访问：先读取arr，再读取arr的length，消耗 2 个单位的能量
```

### 4. 本次代码优化背后的逻辑

- 两个知识点：

  - 1. for 循环的初始化语句只执行一次
  - 2. 直接访问某个属性（或变量）比间接访问效率略高

- 回顾本节顶部的优化案例：

  - 优化前，我们在循环过程中多次执行 **判断条件**，也就意味着我们多次进行了 **间接访问**
  - 优化后，我们在进入循环时，把 length 属性放在 **初始化语句** 中，只执行一次，也就意味着我们多次执行的是 **直接访问**，因此，效率就略高

- 思考：

  - 除了在 for 循环中遍历 数组这种操作，假如在其他循环，例如 forEach, map 等等，如果在 **234（循环结构）中有进行 间接访问数据** 这种操作，我们就应该尝试：使用一个 **临时变量** 来存储这个 **间接数据**
